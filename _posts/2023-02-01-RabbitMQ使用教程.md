## 1. 安装RabbitMQ

**1.1 **以下三个为rabbitMQ依赖包







**1.2 **将安装包上传至服务器

![](https://tcs.teambition.net/storage/312ma6057406dcc1e039305f3e857cdf2374?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY4NzE2ODM2MCwiaWF0IjoxNjg2NTYzNTYwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMm1hNjA1NzQwNmRjYzFlMDM5MzA1ZjNlODU3Y2RmMjM3NCJ9.zA4EO6qsp-qPUkyhJXJxi58PS9cwNEhZ3flrnWBs6nU&download=image.png "")

**1.3 **通过以下命令进行安装

```shell
# 安装erlang
yum install esl-erlang_23.0-1_centos_7_amd64.rpm -y
yum install esl-erlang-compat-18.1-1.noarch.rpm -y

# 安装rabbitmq
rpm -ivh rabbitmq-server-3.8.9-1.el7.noarch.rpm
```

如果遇到以下错误

![](https://tcs.teambition.net/storage/312m7944ee1dbc415b9a260c9d12a8c698a8?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY4NzE2ODM2MCwiaWF0IjoxNjg2NTYzNTYwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMm03OTQ0ZWUxZGJjNDE1YjlhMjYwYzlkMTJhOGM2OThhOCJ9.stXy5DaKgsJbTT5OjYOZahzQ_iaLBCL3v5PApp2ntVs&download=image.png "")

```shell
#通过如下命令可下载好依赖
yum install socat
```

下载依赖后重试即可完成安装

## 2. 启动RabbitMQ

**2.1 **通过如下命令可启动

```shell
service rabbitmq-server start
```

**2.2 **通过如下命令查看rabbitmq状态

```shell
ps -ef | grep rabbitmq
```

![](https://tcs.teambition.net/storage/312mb15b40ee206a7feb1fda64c628078315?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY4NzE2ODM2MCwiaWF0IjoxNjg2NTYzNTYwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMm1iMTViNDBlZTIwNmE3ZmViMWZkYTY0YzYyODA3ODMxNSJ9.Uf6sYGD7MFHpkfDhn0yeje3RML37aNSwibEh2oFfc-0&download=image.png "")

**2.3 **通过如下命令可启动web插件 开启web管理模块

```shell
rabbitmq-plugins enable rabbitmq_management
```

![](https://tcs.teambition.net/storage/312m267326b9cf0cac4ed3d2b072d064b683?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY4NzE2ODM2MCwiaWF0IjoxNjg2NTYzNTYwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMm0yNjczMjZiOWNmMGNhYzRlZDNkMmIwNzJkMDY0YjY4MyJ9.EQezgEtYQYU103ONnCUx44nG930wybIlJHST-aVXheY&download=image.png "")

开启web管理模块插件之后访问：[http://服务器的ip:15672/](http://43.142.115.208:15672/) 可以找到登陆入口

**ps: **如果本地无法连接上:

**ps.1**查看服务器端口是否开放

```shell
#通过如下命令查看端口状态(如果无15672端口则添加)
firewall-cmd --list-port

#防火墙添加15672端口
firewall-cmd --zone=public --add-port=15672/tcp --permanent

#修改完后重启防火墙
firewall-cmd --reload
```

![](https://tcs.teambition.net/storage/312ma00beaa547f972e905c07589d883cb94?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY4NzE2ODM2MCwiaWF0IjoxNjg2NTYzNTYwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMm1hMDBiZWFhNTQ3Zjk3MmU5MDVjMDc1ODlkODgzY2I5NCJ9.2TXI7BfxDcLI5uB16_FEX86NrliyAN6DO1XpaIgwzK4&download=image.png "")

**ps.2 **如果是云服务器还需要登录云管理防火墙添加规则

![](https://tcs.teambition.net/storage/312me75e0e8dafcc7f7208ed2fcdf45295cb?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY4NzE2ODM2MCwiaWF0IjoxNjg2NTYzNTYwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMm1lNzVlMGU4ZGFmY2M3ZjcyMDhlZDJmY2RmNDUyOTVjYiJ9.GApZbBtOnvfly-9tLLO5YQ6Flrrl7Mu6DZAQEIsFYTg&download=image.png "")

此时页面已经可以访问

![](https://tcs.teambition.net/storage/312mf87619efaba362e72784e9abdaaea264?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY4NzE2ODM2MCwiaWF0IjoxNjg2NTYzNTYwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMm1mODc2MTllZmFiYTM2MmU3Mjc4NGU5YWJkYWFlYTI2NCJ9.c-wS5oE4m6WgSpO35GvmnZkKlEQQD-k6HhPKg2v_WNU&download=image.png "")

**2.4 **设置rabbitmq开机启动

```shell
chkconfig rabbitmq-server on
```

## 3. 登录RabbitMQ

**ps:** 什么是Authentication（认证）:

RabbitMQ启动之后，我们想使用它的前提是用username、password连接上它。这里所说的username和passowrd其实就是一个被授予一定权限的用户。

用户连接上RabbitMQ即可创建virtual host使用MQ。在说什么是virtual host之前，先说下RabbitMQ默认有的被授权的用户：username=guest、password=guest、virtualhost=/。

但是这个用户被限制了只能在RabbitMQ所在机器的本地才能登陆MQ（不允许你使用该用户通过ip+port远程登录RabbitMQ），就像下面这样：

![](https://tcs.teambition.net/storage/312m13104fcf5c946cbb57fc9a3ece54636b?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY4NzE2ODM2MCwiaWF0IjoxNjg2NTYzNTYwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMm0xMzEwNGZjZjVjOTQ2Y2JiNTdmYzlhM2VjZTU0NjM2YiJ9.hgdsTTId47r_P5RC0EAuLtFDlgXpAPRWG2gR84LLeIk&download=image.png "")

你使用特定的用户去连接MQ的过程即为Authentication

**3.1 **指定RabbitMQ的启动配置文件:

rabbitmq提供给我们一个配置文件模版，默认在：`/usr/share/doc/rabbitmq-server-xxx/rabitmq.conf.example`

如果你没有找到的话也没关系，拷贝一份模版配置，手动创建 `/etc/rabbitmq/rabbitmq.conf` 配置文件，然后将你拷贝的配置放进去也是ok的。

可直接使用下面这个:



注意文件名为：rabbitmq.conf，且要放在/etc/rabbitmq目录下

![](https://tcs.teambition.net/storage/312m66ccde6fb35dd93898aadd443185c468?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY4NzE2ODM2MCwiaWF0IjoxNjg2NTYzNTYwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMm02NmNjZGU2ZmIzNWRkOTM4OThhYWRkNDQzMTg1YzQ2OCJ9.ubiadLZ5wiGcMhT8JE7bFtjiSPKMKGFEkbM45JuawKI&download=1664186198570.png "")

**3.2 **如何让guest用户远程登陆RabbitMQ

可以像下面这样修改你的rabbitmq.conf的配置文件：

添加: loopback_users = none

![](https://tcs.teambition.net/storage/312mb3294e923c7d5d88df75a2d5eac3cd20?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY4NzE2ODM2MCwiaWF0IjoxNjg2NTYzNTYwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMm1iMzI5NGU5MjNjN2Q1ZDg4ZGY3NWEyZDVlYWMzY2QyMCJ9.FKv6u_xs81JeGuDBWB5EuBwm8ITHaeZeNBdledf6jhw&download=image.png "")

重启服务:

```shell
service rabbitmq-server restart
```

登录成功:

![](https://tcs.teambition.net/storage/312m07db6a8f1962dd96e5fd29242d22434d?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY4NzE2ODM2MCwiaWF0IjoxNjg2NTYzNTYwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMm0wN2RiNmE4ZjE5NjJkZDk2ZTVmZDI5MjQyZDIyNDM0ZCJ9.p5x_L9DEskMuzE8VlGmBGqhNbBCeIvpPSaW4KXU9d3M&download=image.png "")

**官方: **强烈不建议允许默认的用户可远程登陆MQ，用过RabbitMQ的程序员都知道默认用户名和密码是啥，这会让你的系统的安全性大大降低！

推荐的做法是：删除默认用户、使用新的安全凭证创建新的用户



## 4. **Rabbit的用户和权限**

我们刚才允许guest这个超级管理员可以远程登陆MQ，于是你可以像下图这样在web页面上管理用户，比如我可以为业务线A，新添加一个用户SteveYin，并且给他administrator的权限，然后这个业务线通过该用户使用MQ。

![](https://tcs.teambition.net/storage/312m2c13bf47d6dbb11c7b54afacceeda791?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY4NzE2ODM2MCwiaWF0IjoxNjg2NTYzNTYwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMm0yYzEzYmY0N2Q2ZGJiMTFjN2I1NGFmYWNjZWVkYTc5MSJ9.XQmErjKLaJMqkni8joTv7huCSamFpnaFsYNLxtIiPG8&download=1664415805224.jpg "")

```shell
#查看拥有哪些用户和权限
rabbitmqctl list_users --formatter=json
```

![](https://tcs.teambition.net/storage/312mec59f663fb90880765e501ce2525d34d?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY4NzE2ODM2MCwiaWF0IjoxNjg2NTYzNTYwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMm1lYzU5ZjY2M2ZiOTA4ODA3NjVlNTAxY2UyNTI1ZDM0ZCJ9.vzNKwsStch2p9wZZF-4zick4f1Bc1Have5mfr0rJ27U&download=image.png "")



## 5. RabbitMQ中的概念

**什么是virtual host**

可以通过MySQL和MySQL中的数据库来理解RabbitMQ和virtual host的关系。

MySQL大家都不陌生，经常会出现多个业务线混用一个MySQL数据库的情况，就像下图这样，每个业务线都在MySQL中创建自己的数据库，使用时各自往各自的数据库中存储数据，彼此相互不干涉。

![](https://tcs.teambition.net/storage/312m0de2de8012e19fb8f2616e6758418575?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY4NzE2ODM2MCwiaWF0IjoxNjg2NTYzNTYwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMm0wZGUyZGU4MDEyZTE5ZmI4ZjI2MTZlNjc1ODQxODU3NSJ9.h8-KlEMUq0yu2b_eTQ2nVcUXiLzI064dZmkpZPTAMcA&download=1664416430299.jpg "")

RabbitMQ和virtual host的关系也差不多，可以让多个业务线同时使用一个RabbitMQ，只要为业务线各个业务线绑定上不同的virtual host即可：

![](https://tcs.teambition.net/storage/312m578333ee8305ef4f45e101e69b046267?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY4NzE2ODM2MCwiaWF0IjoxNjg2NTYzNTYwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMm01NzgzMzNlZTgzMDVlZjRmNDVlMTAxZTY5YjA0NjI2NyJ9.TzlbvS56g-J1v0kL4qmlVgedTmx2woBcK04AzZLHv8U&download=image.png "")

创建virtual host 并指定用户可以使用它

![](https://tcs.teambition.net/storage/312mb55f612e79d556839426243fead4ee91?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY4NzE2ODM2MCwiaWF0IjoxNjg2NTYzNTYwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMm1iNTVmNjEyZTc5ZDU1NjgzOTQyNjI0M2ZlYWQ0ZWU5MSJ9.wDO_qzKPVCH_vI7LNTiQfVG_YymviVExniuSRb6yiQU&download=1664416808673.jpg "")

![](https://tcs.teambition.net/storage/312m5281a5148248307660bf48e34a2e4b10?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY4NzE2ODM2MCwiaWF0IjoxNjg2NTYzNTYwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMm01MjgxYTUxNDgyNDgzMDc2NjBiZjQ4ZTM0YTJlNGIxMCJ9.-4AwSa35aYxHeUGiKU4jiLymg7jsCzyASfbjGZIJ66w&download=image.png "")

这样添加成功

![](https://tcs.teambition.net/storage/312mb73f2555185ba08d01a9a8c7e10bd563?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY4NzE2ODM2MCwiaWF0IjoxNjg2NTYzNTYwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMm1iNzNmMjU1NTE4NWJhMDhkMDFhOWE4YzdlMTBiZDU2MyJ9.wmZvQedEtyfHCacuUKXNGBScRRNmD76OmHq5eP85WQc&download=image.png "")



## 6. RabbitMQ的五种消息模型

![](https://tcs.teambition.net/storage/312ma57a5d277a5dba59b08d37b6fc3e35db?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY4NzE2ODM2MCwiaWF0IjoxNjg2NTYzNTYwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMm1hNTdhNWQyNzdhNWRiYTU5YjA4ZDM3YjZmYzNlMzVkYiJ9.db9KppQWgeJKSVuH0uGrBLUK6yV3JE1kK0RBx-MOuhM&download=image.png "")

![](https://tcs.teambition.net/storage/312m74bc3f6c4789bb92861aff888e32c64f?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY4NzE2ODM2MCwiaWF0IjoxNjg2NTYzNTYwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMm03NGJjM2Y2YzQ3ODliYjkyODYxYWZmODg4ZTMyYzY0ZiJ9.ody6Osvo42nqF_HrcsYnu-2hHlEV3WmZR-KmJkLstKE&download=image.png "")

### 6.1 Hello World

![](https://tcs.teambition.net/storage/312mdabf77dec8046afedf53f112689b8315?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY4NzE2ODM2MCwiaWF0IjoxNjg2NTYzNTYwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMm1kYWJmNzdkZWM4MDQ2YWZlZGY1M2YxMTI2ODliODMxNSJ9.7kpugQ2L0eWxGN0A6Euddsgf6zey4wyzu-Ph47EzHus&download=image.png "")

P（producer/ publisher）：生产者，发送消息的服务

C（consumer）：消费者，接收消息的服务

红色区域就是MQ中的Queue，可以把它理解成一个邮箱

- 首先信件来了不强求必须马上马去拿

- 其次,它是有最大容量的(受主机和磁盘的限制,是一个缓存区)

- 允许多个消费者监听同一个队列，争抢消息

在本小节中你可以重点看一下当你通过代码建立连接、创建channel、发送消息、接受消息的同时，在web view中，都有何变化。

创建一个SpringBoot项目, rabbitmq需要以下依赖



创建Send类

![](https://tcs.teambition.net/storage/312ma0f387e2a3e22b113aa91c999416609b?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY4NzE2ODM2MCwiaWF0IjoxNjg2NTYzNTYwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMm1hMGYzODdlMmEzZTIyYjExM2FhOTFjOTk5NDE2NjA5YiJ9.GTOnDQXhHneLgb0DabIJxoXwD21w_XHTX6nyQhPKrXE&download=image.png "")

代码执行的时候碰到这个错误

![](https://tcs.teambition.net/storage/312m5c2e7814303b88e53167cbe90b50db71?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY4NzE2ODM2MCwiaWF0IjoxNjg2NTYzNTYwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMm01YzJlNzgxNDMwM2I4OGU1MzE2N2NiZTkwYjUwZGI3MSJ9.xA-PIAwegFF2m05Qn7p7azT7NOBMFpK2bCTsYSBFFNQ&download=image.png "")



原因是因为服务器没有开放5672端口, 需要将防火墙端口开放和腾讯云防火墙策略添加

**防火墙端口开放: **

![](https://tcs.teambition.net/storage/312m597de2acb1426616d66d907f006c3f49?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY4NzE2ODM2MCwiaWF0IjoxNjg2NTYzNTYwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMm01OTdkZTJhY2IxNDI2NjE2ZDY2ZDkwN2YwMDZjM2Y0OSJ9.kZpK3TcGIcHRKn2pkk226eLC7FjPlMe3FtNvupcOoF4&download=image.png "")



```shell
#防火墙添加
firewall-cmd --zone=public --add-port=5672/tcp --permanent
#重启防火墙
firewall-cmd --reload
```

**腾讯云防火墙策略添加:**

![](https://tcs.teambition.net/storage/312mda65d98f669696daab42914d7c419588?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY4NzE2ODM2MCwiaWF0IjoxNjg2NTYzNTYwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMm1kYTY1ZDk4ZjY2OTY5NmRhYWI0MjkxNGQ3YzQxOTU4OCJ9.naqsspyZKAEwzTb3Uxs0egT9zAJYExiMSXGJuV7Psdg&download=image.png "")

然后运行Send中的main方法:

运行成功查看web页面:

![](https://tcs.teambition.net/storage/312mc4c637097ad0334bb079ae41c58b41b3?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY4NzE2ODM2MCwiaWF0IjoxNjg2NTYzNTYwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMm1jNGM2MzcwOTdhZDAzMzRiYjA3OWFlNDFjNThiNDFiMyJ9.mBdFLGqBqWWIlKsnQoWNAZaAerlpY_Zqa1GMReqORo4&download=image.png "")

![](https://tcs.teambition.net/storage/312mfc48a619592e503d2b62c32554d516de?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY4NzE2ODM2MCwiaWF0IjoxNjg2NTYzNTYwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMm1mYzQ4YTYxOTU5MmU1MDNkMmI2MmMzMjU1NGQ1MTZkZSJ9.Cxqjz0Pd-U6JpUexE--ZJiQoLsX_QimdlHK924rKuFE&download=image.png "")

![](https://tcs.teambition.net/storage/312mfbf53d77a918a3d7c0d5db6aa6566dfe?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY4NzE2ODM2MCwiaWF0IjoxNjg2NTYzNTYwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMm1mYmY1M2Q3N2E5MThhM2Q3YzBkNWRiNmFhNjU2NmRmZSJ9.82vlAAapu958HbBiIuzfVSZQfLl2BykY5XnOVKPtlrE&download=image.png "")

创建Recv类

![](https://tcs.teambition.net/storage/312mc375c77bbcc0d775264bee8c340efb53?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY4NzE2ODM2MCwiaWF0IjoxNjg2NTYzNTYwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMm1jMzc1Yzc3YmJjYzBkNzc1MjY0YmVlOGMzNDBlZmI1MyJ9.YBUg71480CmCJ-vYXnzsCqG1QJaLRjAkkLKCvFLmMLI&download=image.png "")

执行main方法, 再去查看web页面中消息的消费状态

![](https://tcs.teambition.net/storage/312ma13ba5b8e35f03f48fa3aa9b748acfd4?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY4NzE2ODM2MCwiaWF0IjoxNjg2NTYzNTYwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMm1hMTNiYTViOGUzNWYwM2Y0OGZhM2FhOWI3NDhhY2ZkNCJ9.NeOx9MqN7xtJ3xfRj89Sb7XPyL1N9fLa7q0dZcgsnyA&download=image.png "")

点击Connections和Channels, 我们可以看到有两个连接:

因为我们没有关闭连接和channl

![](https://tcs.teambition.net/storage/312mc7c5c4c44f287c1d082438127e2701d4?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY4NzE2ODM2MCwiaWF0IjoxNjg2NTYzNTYwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMm1jN2M1YzRjNDRmMjg3YzFkMDgyNDM4MTI3ZTI3MDFkNCJ9.6JnKdtBNPAZOApFmBpTmjE9uTkLGGgOS5loPNPfskxE&download=image.png "")

![](https://tcs.teambition.net/storage/312m2d07f5f74e8514ab44e4af5ce32f1721?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY4NzE2ODM2MCwiaWF0IjoxNjg2NTYzNTYwLCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMm0yZDA3ZjVmNzRlODUxNGFiNDRlNGFmNWNlMzJmMTcyMSJ9.8xUJA5GaFFVcXmo323Ffju18LgDgMwzxchDVkLtUmFE&download=image.png "")

